import fs from 'fs';
import path from 'path';

const visitors = [];
fs.readdirSync(`${path.dirname('.')}/src/visitors`).forEach(visitor => {
  visitors.push(visitor.replace(/\.js$/, ''));
});
visitors.sort();

const output = [`// @flow`, `// generated by scripts/build-visitors.js`, ``];
output.push(`import type Context from './context';`);
output.push(`import t from './babel-types';`);
visitors.forEach(visitor => {
  output.push(`import ${visitor}Visitor from './visitors/${visitor}';`);
});
output.push(``);
output.push(`type Visitor = {`);
output.push(`  +jsx?: (node: Object, context: Context) => JSXValue,`);
output.push(`  +expression: (node: Object, context: Context) => Expression`);
output.push(`};`);
output.push(``);
output.push(`const visitors = {`);
visitors.forEach(visitor => {
  output.push(`  '${visitor}': (${visitor}Visitor: Visitor),`);
});
output.push(`};`);
output.push(`export default visitors;`);
output.push(``);

fs.writeFileSync(
  `${path.dirname('.')}/src/visitors.generated.js`,
  output.join('\n'),
);
